# Prerequisites

- [Git](https://git-scm.com/)
- [Volta](https://volta.sh/) - for managing JavaScript command-line tools like Node.jsÂ® and Yarn.
- [.NET SDK](https://dotnet.microsoft.com/en-us/download)

## Visual Studio Code - recommended extensions

A list of recommended extensions is stored in `.vscode/extenstions.json`. You'll get a notification asking you to install the extensions when you open the project in VS Code for the first time.

## DataHub Application (app-dh)

Deployed version of the application in different environments:

- [U-001](https://jolly-sand-03f839703.azurestaticapps.net)
- [U-002](https://wonderful-field-057109603.1.azurestaticapps.net)
- [T-001](https://lively-river-0f22ad403.azurestaticapps.net)
- [B-001](https://blue-rock-05b7e5e03.azurestaticapps.net)
- [B-002](https://purple-forest-07e41fb03.azurestaticapps.net)

**Please note:** that B2C currently only runs on a single environment **U-002**. However, it can be accessed from **[localhost](https://localhost:4200), U-001** and **U-002**.

### Deployment

The deployments can be found [here](https://github.com/Energinet-DataHub/dh3-environments/actions/workflows/dh-ui-frontend-cd.yml).

### Running the application

To run the application locally you need to serve the frontend application and corresponding BFF (Backend-for-Frontend).

### Frontend application

`yarn nx serve app-dh`

### BFF (Backend-for-Frontend)

#### Setup

Before you're able to run the BFF locally you need to copy `build/ci/dh/api-dh/ci.appsettings.Development.json` -> `apps/dh/api-dh/source/DataHub.WebApi/appsettings.Development.json`. If you're using PowerShell Core or another Terminal that supports `cp`, you can do it with:

`yarn nx run api-dh:ci-configuration`

Otherwise you need to do the copying manually. This should be done everytime a new client is added.

#### Generating HttpClient and DTOs

After the BFF is built, a Swagger definition file is generated. We use this file to auto-generate any HttpClients and DTOs needed to communicate with the BFF. To do that run:

`yarn nx run api-dh:build-client`

Note: The files are automatically placed in `libs/dh/shared/domain/src/lib/generated/v1/**`. You **must not** modify these files manually.

#### Starting the BFF locally

`yarn nx serve api-dh`

### Unit / Integration Testing

Currently the test suites are integrating with the BFF (Backend-for-Frontend), so to run the tests succesfully make sure you're already serving the backend locally.

`yarn test`

While developing you can run the tests in watch mode:

`yarn test --watch`

### E2E Testing

Due to the limitations of Cypress authenticating against MSAL (B2C), we have chosen to use Playwright for our E2E tests. To be able to running the tests locally, you will need to rename `apps\dh\e2e-dh\.env` to `apps\dh\e2e-dh\.env.local` and insert some testing user credentials.

To run the tests use following command:

`yarn nx run e2e-dh:e2e`

To debug E2E tests with the Playwright inspector you can use following command (Windows PowerShell), you can find more information [here](https://playwright.dev/docs/debug):

`yarn nx run e2e-dh:e2e --debug`

### Generating new components

New components can be generated by the command-line or through the Nx Console extension from Visual Studio Code.

`yarn nx generate @schematics/angular:component --name=<my-new-awesome-component> --project=<library-name> --prefix=dh --skipImport`

### Generating new libraries

New libraries can be generated by the command-line or through the Nx Console extension from Visual Studio Code.

`nx generate @nrwl/angular:library --name=<libary type>-my-awesome-library --directory=dh/<domain> --importPath=@energinet-datahub/dh/metering-point/my-awesome-lib --prefix=dh --skipPackageJson --standaloneConfig --tags=product:dh,domain:<domain>,type:<library type>`

## Design System

The design system is deployed through Chromatic, and can be found here:  
[Latest version (main)](https://main--61765fc47451ff003afe62ff.chromatic.com/)

You can also find a deployed version of your specific branch here (direct link, can also be found under checks in a pull-request):
`https://<branch>--61765fc47451ff003afe62ff.chromatic.com`

### Running it locally

`yarn designsystem:start`

## Architecture

The repository is a mono-repo which hosts serveral applications. This means that dependencies are shared by every application inside this repository.  
`Example: every application is running the same version of Angular.`

The repository is setup using [Nx from Nrwl](https://nx.dev/getting-started/intro) which means that you shouldn't use the `Angular CLI` directly.

### Dependency graph / Project Graph

You can generate a dependency graph by running following command, to get an overview of the applications in the mono-repo:

`yarn dep-graph`
