<!--
@license
Copyright 2020 Energinet DataHub A/S

Licensed under the Apache License, Version 2.0 (the "License2");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>DataHub</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://stordesignendku.z6.web.core.windows.net/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://stordesignendku.z6.web.core.windows.net/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://stordesignendku.z6.web.core.windows.net/favicon-16x16.png"
    />
    <link rel="manifest" href="https://stordesignendku.z6.web.core.windows.net/site.webmanifest" />
    <link
      rel="mask-icon"
      href="https://stordesignendku.z6.web.core.windows.net/safari-pinned-tab.svg"
      color="#00847c"
    />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />
    <!--- End Favicon -->

    <!-- Open Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet" />
    <!-- End of Open Sans -->

    <style>
      /** Form **/
      button#cancel {
        display: none;
      }

      .email_li {
        display: block;
        margin-top: 25px;
      }

      .verifyCode {
        margin-bottom: 10px;
      }

      .changeClaims {
        display: none !important;
      }

      div.error.itemLevel.show {
        display: none;
      }

      .div.error.itemLevel.show {
        display: none;
      }

      .hideButton {
        display: none;
      }

      .sendNewCode {
        background: var(--color-neutral-white);
        color: var(--typography-button-color);
      }

      .sendNewCode:hover {
        background: transparent;
      }

      /* Remove and change azure elements */
    </style>
    <script>
      let sendCodeBtnTriggerd = false;
      let sendVerificationCodeBtnTriggerd = false;

      function toggleErrorClasses() {
        var hasEmailErrorElment = document.querySelector(".email .error.itemLevel.show");
        var hasVerificationCodeError = document.querySelector(
          ".VerificationCode .error.itemLevel.show"
        );

        let emailInput = document.querySelector("input#email");
        let emailLabel = document.querySelector("#email_label");
        let emailInputInValid = !emailInput.validity.valid;

        let emailVerificationCodeInput = document.querySelector("input#emailVerificationCode");
        let emailVerificationCodeLabel = document.querySelector("#emailVerificationCode_label");

        emailLabel.classList.toggle(
          "error",
          (emailInputInValid || emailInput.value.length <= 1) && sendCodeBtnTriggerd
        );
        emailInput.classList.toggle(
          "error-border",
          (emailInputInValid || emailInput.value.length <= 1) && sendCodeBtnTriggerd
        );

        emailVerificationCodeLabel.classList.toggle(
          "error",
          sendVerificationCodeBtnTriggerd && emailVerificationCodeInput.value.length <= 0
        );
        emailVerificationCodeInput.classList.toggle(
          "error-border",
          hasVerificationCodeError && emailVerificationCodeInput.value.length <= 0
        );
      }

      function mutationObserverCallBack(mutationList) {
        mutationList.forEach((mutation) => {
          switch (mutation.type) {
            case "attributes":
              switch (mutation.attributeName) {
                case "disabled":
                  console.log("d", mutation.target.disabled);
                  var emailVerificationCodeElm = document.querySelector("#emailVerificationCode");
                  var errorTextElemIsHidden =
                    document.getElementById("emailVerificationControl_error_message").style
                      .display == "none";
                  var showContinue =
                    mutation.target.disabled &&
                    errorTextElemIsHidden &&
                    emailVerificationCodeElm.value.length >= 4;
                  document
                    .querySelector("button#continue")
                    .classList.toggle("hideButton", !showContinue);
                  break;
              }
              break;
          }
        });
      }

      function init() {
        Utils.waitFor("input#email", function (element) {
          const observer = new MutationObserver(mutationObserverCallBack);
          observer.observe(element, {
            attributeFilter: ["disabled"],
            attributeOldValue: true,
          });
        });
        Utils.waitFor("button#continue", function (element) {
          element.classList.add("hideButton");
        });
        Utils.waitFor("button.sendCode", function (element) {
          element.addEventListener("click", function () {
            sendCodeBtnTriggerd = true;
            toggleErrorClasses();
          });
        });
        Utils.waitFor("button.verifyCode", function (element) {
          element.addEventListener("click", function () {
            sendVerificationCodeBtnTriggerd = true;
            toggleErrorClasses();
          });
        });
        Utils.waitFor("button.sendNewCode", function (element) {
          element.addEventListener("click", toggleErrorClasses);
        });
        Utils.waitFor("#email", function (element) {
          element.addEventListener("input", function () {
            toggleErrorClasses();
          });
        });
        Utils.waitFor("#emailVerificationCode", function (element) {
          element.addEventListener("input", function () {
            toggleErrorClasses();
          });
        });
      }
    </script>
    <script>
      const path = window.SETTINGS
        ? SETTINGS.remoteResource.replace(SETTINGS.remoteResource.split("/").pop(), "")
        : "";

      var head = document.getElementsByTagName("head")[0];
      var link = document.createElement("link");
      link.rel = "stylesheet";
      link.type = "text/css";
      link.href = path + "main.css";
      head.appendChild(link);

      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = path + "main.js";
      script.onload = init;
      head.appendChild(script);
    </script>
  </head>
  <body>
    <main>
      <div class="logo"></div>
      <div class="forgot-password-form">
        <h2 aria-level="1" class="imprint imprint-da">Gennemfør oprettelse</h2>
        <h2 aria-level="1" class="imprint imprint-en">Complete sign up</h2>

        <p class="imprint imprint-da">Bekræftelseskoden er sendt til din email</p>
        <p class="imprint imprint-en">Confirmation code is send to our email</p>
        <div id="api" data-name="SelfAsserted">
          <div class="heading">
            <h1 role="heading">User Details</h1>
          </div>
          <div class="buttons"></div>
          <div class="intro">
            <p>Please provide the following details.</p>
          </div>
          <form id="attributeVerification" action="JavaScript:void(0);">
            <div
              id="requiredFieldMissing"
              class="error pageLevel"
              style="display: none"
              aria-hidden="true"
            >
              A required field is missing. Please fill out all required fields and try again.
            </div>
            <div
              id="fieldIncorrect"
              class="error pageLevel"
              style="display: none"
              aria-hidden="true"
            >
              One or more fields are filled out incorrectly. Please check your entries and try
              again.
            </div>
            <div
              id="claimVerificationServerError"
              class="error pageLevel"
              style="display: none"
              aria-hidden="true"
            ></div>
            <div id="attributeList" class="attr">
              <ul>
                <li class="VerificationControl emailVerificationControl_li">
                  <div class="attrEntry">
                    <label
                      id="emailVerificationControl_label"
                      for="emailVerificationControl"
                    ></label>
                    <div class="error itemLevel" role="alert"></div>
                    <div class="verificationControlContent" id="emailVerificationControl">
                      <div class="verificationInfoText">
                        <div
                          id="emailVerificationControl_info_message"
                          aria-hidden="true"
                          role="alert"
                          aria-label="Verification is necessary. Please click Send button."
                          style="display: none"
                        >
                          Verification is necessary. Please click Send button.
                        </div>
                      </div>
                      <div class="verificationSuccessText">
                        <div
                          id="emailVerificationControl_success_message"
                          aria-hidden="false"
                          role="alert"
                          aria-label="Verification code has been sent to your inbox. Please copy it to the input box below."
                          style="display: inline"
                        >
                          Verification code has been sent to your inbox. Please copy it to the input
                          box below.
                        </div>
                      </div>
                      <div class="verificationErrorText error">
                        <div
                          id="emailVerificationControl_error_message"
                          aria-hidden="true"
                          role="alert"
                          aria-label=""
                          style="display: none"
                        ></div>
                      </div>
                      <ul>
                        <li
                          class="EmailBox email_li email"
                          aria-hidden="false"
                          style="display: inline"
                        >
                          <div class="attrEntry">
                            <label id="email_label" for="email" class="">Email Address*</label>
                            <div
                              class="error itemLevel"
                              role="alert"
                              aria-hidden="true"
                              aria-label=""
                            ></div>
                            <input
                              id="email"
                              class="textInput"
                              type="email"
                              placeholder="Email Address"
                              pattern="^[a-zA-Z0-9!#$%&amp;'+^_`{}~-]+(?:\.[a-zA-Z0-9!#$%&amp;'+^_`{}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$"
                              title="Email address that can be used to contact you."
                              aria-required="true"
                              autofocus="autofocus"
                              data-com-onepassword-filled="light"
                            /><a
                              class="helpLink tiny"
                              href="javascript:void(0)"
                              data-help="Email address that can be used to contact you."
                              >What is this?</a
                            >
                          </div>
                        </li>
                        <li
                          class="TextBox emailVerificationCode_li VerificationCode"
                          aria-hidden="false"
                          style="display: inline"
                        >
                          <div class="attrEntry">
                            <label id="emailVerificationCode_label" for="emailVerificationCode"
                              >Verification Code*</label
                            >
                            <div
                              class="error itemLevel"
                              role="alert"
                              aria-hidden="true"
                              aria-label=""
                            ></div>
                            <input
                              id="emailVerificationCode"
                              class="textInput"
                              type="text"
                              placeholder="Verification Code"
                              title="Verification code received in the email."
                              aria-required="true"
                              autocomplete="off"
                            /><a
                              class="helpLink tiny"
                              href="javascript:void(0)"
                              data-help="Verification code received in the email."
                              >What is this?</a
                            >
                          </div>
                        </li>
                      </ul>
                      <div
                        class="working"
                        style="display: none"
                        aria-hidden="true"
                        aria-label="Please wait"
                      ></div>
                      <div class="buttons">
                        <button
                          class="sendCode"
                          id="emailVerificationControl_but_send_code"
                          type="button"
                          aria-label="Send verification code"
                          aria-hidden="true"
                          style="display: none"
                        >
                          Send verification code</button
                        ><button
                          class="verifyCode"
                          id="emailVerificationControl_but_verify_code"
                          type="button"
                          aria-label="Verify code"
                          aria-hidden="false"
                          style="display: inline"
                        >
                          Verify code</button
                        ><button
                          class="sendNewCode"
                          id="emailVerificationControl_but_send_new_code"
                          type="button"
                          aria-label="Send new code"
                          aria-hidden="false"
                          style="display: inline"
                        >
                          Send new code</button
                        ><button
                          class="changeClaims"
                          id="emailVerificationControl_but_change_claims"
                          type="button"
                          aria-label="Change e-mail Email Address"
                          aria-hidden="true"
                          style="display: none"
                        >
                          Change e-mail
                        </button>
                      </div>
                    </div>
                    <a class="helpLink tiny" href="javascript:void(0)">What is this?</a>
                  </div>
                </li>
              </ul>
            </div>
            <div class="buttons">
              <button
                id="continue"
                type="submit"
                form="attributeVerification"
                aria-disabled="true"
                aria-label="Continue"
                tabindex="-1"
                class="hideButton"
              >
                Continue</button
              ><button id="cancel" aria-label="Cancel" formnovalidate="">Cancel</button>
            </div>

            <div class="verifying-modal">
              <div id="verifying_blurb"></div>
            </div>
          </form>
        </div>
      </div>
    </main>
  </body>
</html>
