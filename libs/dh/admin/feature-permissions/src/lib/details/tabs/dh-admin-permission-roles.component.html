<ng-container *rxLet="loading as isLoading">
  <watt-card variant="solid" *transloco="let t; read: 'admin.userManagement.tabs.history'">
    <div *ngIf="isLoading" class="spinner">
      <watt-spinner></watt-spinner>
    </div>

    <ng-container *ngIf="!isLoading">
      <watt-card-title *rxLet="permissionLogs?.length as auditLogCount">
        <h4 *ngIf="auditLogCount === 1 && !error">
          {{t("changesSingular", {auditLogCount})}}
        </h4>
        <h4 *ngIf="auditLogCount !== 1 && !error">
          {{t("changesPlural", {auditLogCount})}}
        </h4>
      </watt-card-title>

      <watt-table
        [columns]="columns"
        [dataSource]="dataSource"
        sortBy="timestamp"
        sortDirection="desc"
        [sortClear]="false"
        [resolveHeader]="translateHeader"
        *ngIf="!error"
      >
        <ng-container *wattTableCell="columns['timestamp']; let element">
          {{ element.timestamp | dhDateTime }}
        </ng-container>

        <ng-container *wattTableCell="columns['entry']; let element">
          <div
            [innerHTML]="
              t('logs.permissionsDetails.auditLogType.' + element.permissionAuditLogType, element)
            "
          ></div>
        </ng-container>
      </watt-table>

      <watt-empty-state
        *ngIf="error"
        icon="custom-power"
        [title]="'shared.error.title' | transloco"
        [message]="'shared.error.message' | transloco"
      ></watt-empty-state>

      <ng-container *rxLet="permissionLogs?.length as auditLogCount">
        <h4 *ngIf="auditLogCount === 0" class="no-results-text">
          {{ t("noEntries") }}
        </h4>
      </ng-container>
    </ng-container>
  </watt-card>
</ng-container>
